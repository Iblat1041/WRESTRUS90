from aiogram.types import InlineKeyboardMarkup

from bot.keyboards import get_inline_keyboard
from constants_kb.admin import (
    BACK_BUTTON,
    BACK_TO_MAIN_BUTTON,
    CREATE_USER_BUTTON,
    USERS_LIST_BUTTON,
)

ADMIN_USERS_MENU = get_inline_keyboard(
    (USERS_LIST_BUTTON, 'users_list'),
    (CREATE_USER_BUTTON, 'create_user'),
    (BACK_BUTTON, 'back_to_admin_menu'),
    placeholder='Ğ’Ñ‹ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ĞµÑÑŒ Ğ² Ğ¼ĞµĞ½Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹',
    sizes=(2, 2),
)


from aiogram.types import InlineKeyboardMarkup
from aiogram.utils.keyboard import InlineKeyboardBuilder


def get_users_list_keyboard(
    users: list,
    page: int = 0,
    total_users: int = 0,
    per_page: int = 5,
    back_button_text: str = "â¬…ï¸ Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ",
    back_to_main_button_text: str = "ğŸ  ĞĞ° Ğ³Ğ»Ğ°Ğ²Ğ½ÑƒÑ",
) -> InlineKeyboardMarkup:
    """
    Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ñ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸/Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°.

    Args:
        users: Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ.
        page: Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° (Ğ½ÑƒĞ¼ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ 0).
        total_users: ĞĞ±Ñ‰ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.
        per_page: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ.
        back_button_text: Ğ¢ĞµĞºÑÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº Ğ¼ĞµĞ½Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.
        back_to_main_button_text: Ğ¢ĞµĞºÑÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğ½Ğ° Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ.

    Returns:
        InlineKeyboardMarkup: Ğ¡Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ°.
    """
    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
    buttons = [
        (f"{user.name} {user.email or ''}", f"user_{user.id}")
        for user in users
    ]

    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
    navigation_buttons = []
    if page > 0:
        navigation_buttons.append(('â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´', f'prev_page_{page-1}'))
    if (page + 1) * per_page < total_users:
        navigation_buttons.append(('Ğ’Ğ¿ĞµÑ€ĞµĞ´ â¡ï¸', f'next_page_{page+1}'))
    buttons.extend(navigation_buttons)

    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°
    buttons.extend(
        [
            (back_button_text, 'back_to_users_menu'),
            (back_to_main_button_text, 'cancel_to_main_menu'),
        ],
    )

    # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº Ğ´Ğ»Ñ sizes
    num_user_rows = len(users)  # ĞĞ´Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ
    nav_and_back_rows = 1  # ĞĞ´Ğ½Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ´Ğ»Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°
    sizes = (1,) * num_user_rows + (2,) * nav_and_back_rows

    return get_inline_keyboard(
        *buttons,
        sizes=sizes,
        placeholder='Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ',
    )
