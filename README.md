# Шаблон для проектов со стилизатором Ruff

## Основное

1. Базовая версия Python - 3.11.
2. В файле `requirements_style.txt` находятся зависимости для стилистики.
3. В каталоге `src` находится базовая структура проекта
4. В файле `src/requirements.txt` прописываются базовые зависимости.
5. В каталоге `infra` находятся настроечные файлы проекта. Здесь же размещать файлы для docker compose.

## Стилистика

Для стилизации кода используется пакеты `Ruff` и `Pre-commit`

Проверка стилистики кода осуществляется командой
```shell
ruff check
```

Если одновременно надо пофиксить то, что можно поиксить автоматически, то добавляем параметр `--fix`
```shell
ruff check --fix
```

Что бы стилистика автоматически проверялась и поправлялась при комитах надо добавить hook pre-commit к git

```shell
pre-commit install
```

# Запуск PostgreSQL в Docker

1. Перейдите в папку `infra`:
```bash
cd infra
```

2. Запустите PostgreSQL в Docker, используя файл `docker-compose.yml`:
```bash
docker-compose -f docker-compose.yml up -d
```

3. Дождитесь полного запуска контейнеров (это может занять несколько секунд).

4. Проверьте статус контейнеров:
```bash
docker-compose -f docker-compose.yml ps
```

5. Проверьте логи (если необходимо):
```bash
docker-compose -f docker-compose.yml logs
```

> **Важно**: PostgreSQL должен быть запущен и полностью готов к работе перед запуском проекта.

# Запуск проекта:

## Клонирование репозитория и настройка окружения

1. Клонируйте репозиторий:
```bash
git clone <url-репозитория>
cd smena_collective_team2
```

2. Создайте виртуальное окружение:
```bash
python3 -m venv venv
```

3. Активируйте виртуальное окружение:
- Для macOS/Linux:
```bash
source venv/bin/activate
```
- Для Windows:
```bash
venv\Scripts\activate
```

4. Установите зависимости:
```bash
pip install -r src/requirements.txt
```

5. Создайте файл `.env` в папке `infra` с переменными из `.env.example`:


## Создание туннеля

Для быстрого создания публичного URL, который перенаправляет трафик на локальный сервер используется Localtunnel.

1. Установите Localtunnel (если еще не установлен):
```bash
sudo npm install -g localtunnel
```

2. Создайте туннель (в отдельном терминале):
```bash
lt --port 8443
```

3. Скопируйте сгенерированный URL (например, https://ваш_субдомен.loca.lt).

4. Обновите URL в поле `WEBHOOK_HOST` в файле `infra/.env`. Сохраните файл.

5. Откройте браузер и перейдите по сгенерированному URL.

6. В открывшемся окне откройте в новой вкладке ссылку https://loca.lt/mytunnelpassword

7. Скопируйте пароль из новой вкладки и вставьте его в поле пароля "Tunnel Password" на странице создания туннеля, затем нажмите кнопку "Click to Submit".

## Запуск проекта

1. Перейдите в папку `src`:
```bash
cd src
```

2. Создайте новые миграции (также при изменении моделей применять):
```bash
alembic -c db/alembic.ini revision --autogenerate -m "init"
```

3. Выполните миграции базы данных:
```bash
alembic -c db/alembic.ini upgrade head
```

4. Запустите проект:
```bash
python main.py
```

## Вход в панель администрирования

Откройте в браузере: сгенерированный URL + /admin/ (например, https://ваш_субдомен.loca.lt/admin/)

Используйте данные суперпользователя из файла `.env` для входа.